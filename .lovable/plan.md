

# Настройки групповых чатов (Telegram-style)

## Что сейчас есть

Текущая реализация групп минимальная:
- Создание группы (только имя, без описания/фото)
- Отправка/получение сообщений
- Меню с кнопками "Участники", "Добавить участников", "Покинуть группу" (большинство не работает)
- Нет экрана настроек/профиля группы
- Нет возможности редактировать имя, описание, фото группы
- Нет управления участниками (назначение ролей, удаление)
- Нет поиска пользователей для добавления

## Что будет реализовано

Полноценная система управления группой по образцу Telegram:

### 1. Экран профиля/настроек группы (GroupInfoSheet)
Откроется при нажатии на заголовок группы в шапке или через меню:
- Аватар группы (с возможностью смены для владельца/админа)
- Название группы (редактируемое)
- Описание группы (редактируемое)
- Список участников с ролями (owner/admin/member)
- Кнопки действий: уведомления, поиск, покинуть группу

### 2. Экран редактирования группы (EditGroupSheet)
Доступен только владельцу и админам:
- Смена аватара (загрузка в storage bucket `chat-media`)
- Редактирование названия
- Редактирование описания

### 3. Управление участниками
- Просмотр полного списка участников с ролями
- Добавление участников (поиск по имени из профилей)
- Удаление участников (только владелец)
- Назначение/снятие роли "admin" (только владелец)

### 4. Экран добавления участников (AddMembersSheet)
- Поиск пользователей по имени
- Множественный выбор
- Отображение уже добавленных участников

## Технические детали

### База данных (миграция)
Нужно добавить UPDATE-политику для `group_chat_members`, чтобы владелец мог менять роли участников:

```text
CREATE POLICY "gcm_update_owner" ON public.group_chat_members
FOR UPDATE USING (
  EXISTS (
    SELECT 1 FROM group_chats
    WHERE group_chats.id = group_chat_members.group_id
    AND group_chats.owner_id = auth.uid()
  )
);
```

### Новые компоненты

**`src/components/chat/GroupInfoSheet.tsx`** -- основной экран профиля группы:
- Аватар группы (большой, по центру)
- Название и описание
- Кнопки: Уведомления, Поиск, Ещё
- Секция "Участники" -- список с ролями
- Кнопка "Добавить участника" (для owner/admin)
- Кнопка "Покинуть группу"
- Кнопка "Редактировать" (для owner/admin)

**`src/components/chat/EditGroupSheet.tsx`** -- редактирование группы:
- Загрузка аватара через file input -> storage bucket `chat-media`
- Поля: название, описание
- Кнопка "Сохранить" -- обновляет `group_chats` через Supabase

**`src/components/chat/AddGroupMembersSheet.tsx`** -- добавление участников:
- Поиск пользователей (запрос к `profiles`)
- Фильтрация уже добавленных участников
- Вставка в `group_chat_members`

### Изменения в существующих файлах

**`src/hooks/useGroupChats.tsx`**:
- Добавить функцию `updateGroup(groupId, { name, description, avatar_url })`
- Добавить функцию `addMember(groupId, userId)`
- Добавить функцию `removeMember(groupId, userId)`
- Добавить функцию `updateMemberRole(groupId, userId, role)`

**`src/components/chat/GroupConversation.tsx`**:
- Сделать заголовок кликабельным -- открывает GroupInfoSheet
- Убрать текущее dropdown-меню (перенести функционал в GroupInfoSheet)
- Убрать баннер "Добавить участников" (перенести в GroupInfoSheet)
- Добавить `useState` для управления открытием листов
- Передавать обновлённые данные группы после редактирования

### Стилистика
Все новые компоненты следуют существующему дизайну проекта:
- Glassmorphism (backdrop-blur-xl, bg-white/10, border-white/20)
- BrandBackground с анимированными орбами
- Цветовая палитра: белый текст, `#6ab3f3` для акцентов
- Sheet (bottom-sheet) для модальных экранов

