

# ะะปะฐะฝ: ะะธะฝะฐะผะธัะตัะบะฐั ะบะฝะพะฟะบะฐ ะทะฐะฟะธัะธ ั ะฟะตัะตะบะปััะตะฝะธะตะผ ัะตะถะธะผะพะฒ

## ะงัะพ ัะตะฐะปะธะทัะตะผ

ะัะฐะฒะฐั ะบะฝะพะฟะบะฐ ะฒ ัะฐัะต ะดะพะปะถะฝะฐ ัะฐะฑะพัะฐัั ะฟะพ ัะปะตะดัััะตะน ะปะพะณะธะบะต:

### ะกะพััะพัะฝะธั ะบะฝะพะฟะบะธ (ะบะพะณะดะฐ ะฟะพะปะต ะฒะฒะพะดะฐ ะฟัััะพะต):
1. **ะะตะถะธะผ "ะณะพะปะพั"** โ ะฟะพะบะฐะทัะฒะฐะตััั ะธะบะพะฝะบะฐ ะผะธะบัะพัะพะฝะฐ
2. **ะะตะถะธะผ "ะบััะถะพะบ"** โ ะฟะพะบะฐะทัะฒะฐะตััั ะธะบะพะฝะบะฐ ะฒะธะดะตะพ-ะบััะถะบะฐ

### ะะตะนััะฒะธั:
- **ะะพัะพัะบะธะน ัะฐะฟ** โ ะฟะตัะตะบะปััะฐะตั ัะตะถะธะผ (ะณะพะปะพั โ ะบััะถะพะบ)
- **ะฃะดะตัะถะฐะฝะธะต (hold)** โ ะฝะฐัะธะฝะฐะตั ะทะฐะฟะธัั ะฒ ัะตะบััะตะผ ัะตะถะธะผะต
- **ะัะฟััะบะฐะฝะธะต** โ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฟัะฐะฒะปัะตั ะทะฐะฟะธัะฐะฝะฝะพะต

### ะะพะณะดะฐ ะตััั ัะตะบัั:
- ะะพะบะฐะทัะฒะฐะตััั ะบะฝะพะฟะบะฐ "ะัะฟัะฐะฒะธัั" (ะฑะตะท ะธะทะผะตะฝะตะฝะธะน)

---

## ะขะตัะฝะธัะตัะบะธะต ะธะทะผะตะฝะตะฝะธั

### 1. ChatConversation.tsx โ ะะพะณะธะบะฐ ะบะฝะพะฟะบะธ

**ะะพะฑะฐะฒะธัั ัะพััะพัะฝะธะต ัะตะถะธะผะฐ:**
```typescript
const [recordMode, setRecordMode] = useState<'voice' | 'video'>('voice');
const [isHolding, setIsHolding] = useState(false);
```

**ะะฑัะฐะฑะพััะธะบะธ ะดะปั hold-to-record:**
```typescript
const handleRecordButtonDown = (e: React.TouchEvent | React.MouseEvent) => {
  e.preventDefault();
  holdTimerRef.current = setTimeout(() => {
    isHoldingRef.current = true;
    if (recordMode === 'voice') {
      startRecording(); // ะณะพะปะพัะพะฒะพะต
    } else {
      setShowVideoRecorder(true); // ะบััะถะพะบ
    }
  }, 150); // ะฝะตะฑะพะปััะฐั ะทะฐะดะตัะถะบะฐ ััะพะฑั ะพัะปะธัะธัั ัะฐะฟ ะพั ัะดะตัะถะฐะฝะธั
};

const handleRecordButtonUp = () => {
  if (holdTimerRef.current) {
    clearTimeout(holdTimerRef.current);
  }
  if (isHoldingRef.current) {
    // ะญัะพ ะฑัะปะพ ัะดะตัะถะฐะฝะธะต โ ะพัะฟัะฐะฒะธัั
    if (recordMode === 'voice' && isRecording) {
      stopRecording(); // ะฐะฒัะพะพัะฟัะฐะฒะบะฐ
    }
    // ะะปั ะฒะธะดะตะพ โ ะพัะฟัะฐะฒะบะฐ ะฒะฝัััะธ VideoCircleRecorder
  } else {
    // ะญัะพ ะฑัะป ัะฐะฟ โ ะฟะตัะตะบะปััะธัั ัะตะถะธะผ
    setRecordMode(prev => prev === 'voice' ? 'video' : 'voice');
  }
  isHoldingRef.current = false;
};
```

**ะะฝะพะฟะบะฐ ั ะดะธะฝะฐะผะธัะตัะบะพะน ะธะบะพะฝะบะพะน:**
```tsx
{inputText.trim() ? (
  <button onClick={handleSendMessage}>
    <Send />
  </button>
) : (
  <button
    onTouchStart={handleRecordButtonDown}
    onTouchEnd={handleRecordButtonUp}
    onMouseDown={handleRecordButtonDown}
    onMouseUp={handleRecordButtonUp}
    onMouseLeave={handleRecordButtonUp}
  >
    {recordMode === 'voice' ? <Mic /> : <Video />}
  </button>
)}
```

---

### 2. VideoCircleRecorder.tsx โ ะะฒัะพะพัะฟัะฐะฒะบะฐ ะฟัะธ ะพัะฟััะบะฐะฝะธะธ

**ะะทะผะตะฝะธัั props:**
```typescript
interface VideoCircleRecorderProps {
  onRecord: (videoBlob: Blob, duration: number) => void;
  onCancel: () => void;
  autoRecord?: boolean; // ััะฐะทั ะฝะฐัะฐัั ะทะฐะฟะธัั
  onRelease?: () => void; // ะฒัะทัะฒะฐะตััั ะฟัะธ ะพัะฟััะบะฐะฝะธะธ ะบะฝะพะฟะบะธ
}
```

**ะะพะณะธะบะฐ:**
- ะัะธ `autoRecord=true` โ ะทะฐะฟัะพัะธัั ะบะฐะผะตัั ะธ ััะฐะทั ะฝะฐัะฐัั ะทะฐะฟะธัั
- ะัะธ ะพัะฟััะบะฐะฝะธะธ (touch/mouse up ะฝะฐ ัะบัะฐะฝะต) โ ะฒัะทะฒะฐัั `stopRecording()` ะธ ะพัะฟัะฐะฒะธัั

**ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพััะธะบ ะพัะฟััะบะฐะฝะธั:**
```tsx
useEffect(() => {
  if (!autoRecord) return;
  
  const handleRelease = () => {
    if (isRecording && recordingTime >= 1) {
      stopRecording(); // ััะพ ะฒัะทะพะฒะตั onRecord
    } else {
      onCancel(); // ัะปะธัะบะพะผ ะบะพัะพัะบะฐั ะทะฐะฟะธัั
    }
  };
  
  window.addEventListener('touchend', handleRelease);
  window.addEventListener('mouseup', handleRelease);
  
  return () => {
    window.removeEventListener('touchend', handleRelease);
    window.removeEventListener('mouseup', handleRelease);
  };
}, [autoRecord, isRecording, recordingTime]);
```

---

### 3. ะะธะทัะฐะปัะฝัะต ะธะฝะดะธะบะฐัะพัั ัะตะถะธะผะฐ

**ะัะธ ะทะฐะฟะธัะธ ะณะพะปะพัะฐ (ะฒ ChatConversation):**
- ะะฐะฝะตะปั ะฒะฝะธะทั ะฟะพะบะฐะทัะฒะฐะตั ัะฐะนะผะตั ะธ ะบะฝะพะฟะบั ะพัะผะตะฝั (ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ)

**ะัะธ ะทะฐะฟะธัะธ ะบััะถะบะฐ:**
- ะะพะปะฝะพัะบัะฐะฝะฝัะน ะธะฝัะตััะตะนั VideoCircleRecorder (ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ)
- ะฃะฑัะฐัั ะบะฝะพะฟะบั "ะะฐะบัััั" ัะฒะตััั โ ะพัะผะตะฝะฐ ัะพะปัะบะพ ัะฒะฐะนะฟะพะผ ะธะปะธ ะพัะฟััะบะฐะฝะธะตะผ

---

## ะคะฐะนะปั ะดะปั ะธะทะผะตะฝะตะฝะธั

| ะคะฐะนะป | ะะทะผะตะฝะตะฝะธั |
|------|-----------|
| `src/components/chat/ChatConversation.tsx` | ะะพะฑะฐะฒะธัั ะปะพะณะธะบั ะฟะตัะตะบะปััะตะฝะธั ัะตะถะธะผะฐ (ัะฐะฟ) ะธ ัะดะตัะถะฐะฝะธั (hold-to-record) |
| `src/components/chat/VideoCircleRecorder.tsx` | ะะพะฑะฐะฒะธัั `autoRecord` prop ะธ ะฐะฒัะพะพัะฟัะฐะฒะบั ะฟัะธ ะพัะฟััะบะฐะฝะธะธ |

---

## ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ะพะฟัั

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะัััะพะต ะฟะพะปะต ะฒะฒะพะดะฐ                      โ
โ                                         โ
โ  [๐ค] โ ัะฐะฟ ะฟะตัะตะบะปััะฐะตั ะฝะฐ ะฒะธะดะตะพ        โ
โ  [๐ค] โ ัะดะตัะถะฐะฝะธะต = ะทะฐะฟะธัั ะณะพะปะพัะฐ       โ
โ                                         โ
โ  ะะพัะปะต ัะฐะฟะฐ:                            โ
โ  [๐น] โ ัะฐะฟ ะฟะตัะตะบะปััะฐะตั ะพะฑัะฐัะฝะพ         โ
โ  [๐น] โ ัะดะตัะถะฐะฝะธะต = ะทะฐะฟะธัั ะบััะถะบะฐ       โ
โ                                         โ
โ  ะััั ัะตะบัั:                            โ
โ  [โค] โ ะพัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธะต              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

